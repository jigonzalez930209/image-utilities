<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <link rel="alternate icon" type="image/x-icon" href="/logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200..800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <title>Image Studio - AI Image Utilities</title>
    <script>
      // Service Worker for COOP/COEP headers (enables SharedArrayBuffer on GitHub Pages)
      if ('serviceWorker' in navigator && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
        const reloadedKey = 'coopCoepReloaded';
        
        window.addEventListener('load', () => {
          console.log('[COOP/COEP] crossOriginIsolated:', self.crossOriginIsolated);
          
          if (window.sessionStorage.getItem(reloadedKey)) {
            window.sessionStorage.removeItem(reloadedKey);
            console.log('[COOP/COEP] Service Worker should be active');
            
            if (!self.crossOriginIsolated) {
              console.error('[COOP/COEP] crossOriginIsolated is still false! Headers may not be working.');
            }
            return;
          }

          navigator.serviceWorker.register('./coop-coep.js', { scope: './' })
            .then(registration => {
              console.log('[COOP/COEP] Service Worker registered:', registration.scope);
              
              if (!navigator.serviceWorker.controller) {
                console.log('[COOP/COEP] Reloading to activate Service Worker...');
                window.sessionStorage.setItem(reloadedKey, 'true');
                setTimeout(() => window.location.reload(), 100);
              } else {
                console.log('[COOP/COEP] Service Worker already controlling');
              }
            })
            .catch(err => console.error('[COOP/COEP] Registration failed:', err));
        });
      } else if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        console.log('[COOP/COEP] Skipping Service Worker on localhost (dev headers already configured)');
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
